const ALERT_ZOOM=chrome.i18n.getMessage("alert_zoom"),ALERT_SOMETHING_WORNG=chrome.i18n.getMessage("alert_something_wrong"),ALERT_SCREEN_TEXT_EMPTY=chrome.i18n.getMessage("alert_screen_text_empty"),ALERT_NO_ANSWER=chrome.i18n.getMessage("alert_no_answer"),ALERT_NO_QUESTION=chrome.i18n.getMessage("alert_no_question"),ALERT_NO_TEXT_SELECTED=chrome.i18n.getMessage("alert_no_text_selected"),ALERT_NO_TEXT_SELECTED_PROMPT=chrome.i18n.getMessage("alert_no_text_selected_prompt"),ALERT_NO_TEXT_SELECTED_PROMPT_SCREEN=chrome.i18n.getMessage("alert_no_text_selected_prompt_screen"),ALERT_NO_TEXT_SELECTED_PROMPT_SCREEN_ZOOM=chrome.i18n.getMessage("alert_no_text_selected_prompt_screen_zoom");class QuizSolverPopup{list_positions={topLeft:{label:"Top Left",value:"top-left",style:{top:"5px",left:"5px"}},centerLeft:{label:"Center Left",value:"center-left",style:{top:"50%",left:"5px",transform:"translate(0, -50%)"}},topRight:{label:"Top Right",value:"top-right",style:{top:"5px",right:"5px"}},centerRight:{label:"Center Right",value:"center-right",style:{top:"50%",right:"5px",transform:"translate(0, -50%)"}},bottomLeft:{label:"Bottom Left",value:"bottom-left",style:{bottom:"5px",left:"5px"}},bottomRight:{label:"Bottom Right",value:"bottom-right",style:{bottom:"5px",right:"5px"}},center:{label:"Center",value:"center",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}};getPositionStyle(e){return this.list_positions[e]?this.list_positions[e].style:this.list_positions.centerRight.style}constructor(e){this.storage=e,this.settings=e&&e.settings?e.settings:null,this.loadHtmlTemplates(),this.handleLikeAnswer=this.handleLikeAnswer.bind(this),this.handleDislikeAnswer=this.handleDislikeAnswer.bind(this),this.handleQuickSnap=this.handleQuickSnap.bind(this)}loadHtmlTemplates(){let e='<svg fill="#000000" height="20px" width="20px"   \n\t viewBox="0 0 232.439 232.439" xml:space="preserve">\n        <g>\n            <path d="M55.416,64.245c-2.804-1.162-6.027-0.52-8.174,1.625L2.197,110.915c-1.406,1.407-2.196,3.314-2.196,5.304\n                c0,1.989,0.79,3.896,2.196,5.304l45.045,45.045c1.436,1.435,3.354,2.196,5.306,2.196c0.966,0,1.941-0.186,2.868-0.571\n                c2.803-1.16,4.63-3.896,4.63-6.929v-90.09C60.046,68.141,58.219,65.405,55.416,64.245z M45.046,143.157l-26.938-26.938\n                L45.046,89.28V143.157z"/>\n            <path d="M121.523,2.196C120.116,0.79,118.209,0,116.22,0c-1.989,0-3.896,0.79-5.304,2.196L65.871,47.241\n                c-2.145,2.146-2.786,5.371-1.625,8.174c1.16,2.803,3.896,4.63,6.929,4.63h90.09c3.033,0,5.769-1.827,6.929-4.63\n                c1.161-2.803,0.52-6.028-1.625-8.174L121.523,2.196z M89.281,45.045l26.938-26.938l26.939,26.938H89.281z"/>\n            <path d="M230.242,110.915L185.197,65.87c-2.145-2.145-5.372-2.788-8.174-1.625c-2.803,1.16-4.63,3.896-4.63,6.929v90.09\n                c0,3.033,1.827,5.769,4.63,6.929c0.928,0.385,1.902,0.571,2.868,0.571c1.952,0,3.87-0.762,5.306-2.196l45.045-45.045\n                c1.406-1.407,2.196-3.314,2.196-5.304C232.438,114.229,231.648,112.322,230.242,110.915z M187.393,143.157V89.28l26.939,26.938\n                L187.393,143.157z"/>\n            <path d="M161.263,172.393H71.175c-3.033,0-5.769,1.827-6.929,4.63c-1.161,2.803-0.52,6.028,1.625,8.174l45.045,45.046\n                c1.407,1.406,3.314,2.196,5.304,2.196c1.989,0,3.896-0.79,5.304-2.197l45.043-45.046c2.145-2.145,2.786-5.37,1.625-8.173\n                C167.031,174.221,164.296,172.393,161.263,172.393z M116.22,214.333l-26.938-26.939h53.876L116.22,214.333z"/>\n        </g>\n        </svg>   ',t='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svg-icon">\n                    <path d="M19,24H17a1,1,0,0,1,0-2h2a3,3,0,0,0,3-3V17a1,1,0,0,1,2,0v2A5.006,5.006,0,0,1,19,24Z" />\n                    <path d="M1,8A1,1,0,0,1,0,7V5A5.006,5.006,0,0,1,5,0H7A1,1,0,0,1,7,2H5A3,3,0,0,0,2,5V7A1,1,0,0,1,1,8Z" />\n                    <path d="M7,24H5a5.006,5.006,0,0,1-5-5V17a1,1,0,0,1,2,0v2a3,3,0,0,0,3,3H7a1,1,0,0,1,0,2Z" />\n                    <path\n                        d="M23,8a1,1,0,0,1-1-1V5a3,3,0,0,0-3-3H17a1,1,0,0,1,0-2h2a5.006,5.006,0,0,1,5,5V7A1,1,0,0,1,23,8Z" />\n                </svg>',s='<svg   viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path fill-rule="evenodd" clip-rule="evenodd" d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6834 19.0976 18.3166 18.7071 18.7071C18.3166 19.0976 17.6834 19.0976 17.2929 18.7071L12 13.4142L6.70711 18.7071C6.31658 19.0976 5.68342 19.0976 5.29289 18.7071C4.90237 18.3166 4.90237 17.6834 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z" fill="#0F1729"/>\n</svg>';this.htmlError=` \n    <header>\n        <div id="qs24-hack-answer-drop">\n            <img id="qs24-hack-logo-img" alt="Drag me" src="https://quizsolverai.com/images/8_mini.png" />\n        </div>\n        <button id="qs24-answer-close" class="btn-answer">X</button>\n    </header>\n    \n    <div id="sq24-box-content">\n        <h2>${chrome.i18n.getMessage("message")} : </h2>\n        <div id="qs24-answer-text">\n            {{error}}\n        </div>\n    </div>\n    <footer>\n            <button id="qs24-answer-close" class="btn-answer">X</button>\n            <button id="qs24-screen-quicksnap" class="btn-icon-answer bg-blue" title="${chrome.i18n.getMessage("quicksnap")}">\n                ${t}    \n            </button>\n             \n             \n        </footer>\n    `,this.htmlErrorGhost=`\n        <header>\n            <div id="qs24-hack-answer-drop" class="bg-ghost-gray">           \n                ${e}     \n            </div> \n        </header>\n        <div id="sq24-box-content">\n            <h2>${chrome.i18n.getMessage("message")} : </h2>\n            <div id="qs24-answer-text">\n                {{error}}\n            </div>\n        </div>\n        <footer>\n            <button id="qs24-answer-copy" class="btn-answer bg-vert" title="${chrome.i18n.getMessage("copy_the_answer")}">                \n                ${chrome.i18n.getMessage("copy")}\n            </button>\n            <button id="qs24-screen-quicksnap" class="btn-icon-answer bg-blue" title="${chrome.i18n.getMessage("quick_snap")}">\n                ${t}\n            </button>\n           <button id="qs24-answer-close" class="btn-answer" titre="${chrome.i18n.getMessage("close")}">\n                ${s}\n           </button>\n        </footer>\n        `,this.htmlContent=`\n \n    <header>\n        <div id="qs24-hack-answer-drop">\n            <img id="qs24-hack-logo-img" alt="Drag me" src="https://quizsolverai.com/images/8_mini.png" />\n        </div>\n        <button id="qs24-answer-close" class="btn-answer">X</button>\n    </header>\n    <div id="sq24-loading" style="display: {{displayLoading}};">\n        <img id="sq24-box-loading" style="max-width: 100%;" src="https://quizsolverai.com/images/loading_animation.gif"\n            alt="${chrome.i18n.getMessage("loading")}" />\n    </div>\n    <div id="sq24-box-content" class="sq24-mathjax" style="display: {{displayContent}};">\n        <div id="question-field" style="display: {{displayQuestion}};">\n            <h2>${chrome.i18n.getMessage("the_question_request")}</h2>\n            <div id="qs24-question-text">\n                {{question}}\n            </div>\n        </div>\n        <hr class="line">\n        <h2>{{labelAnswer}}</h2>\n        <div id="qs24-answer-text">\n            {{answer}}\n        </div>\n        <footer>\n            <button id="qs24-answer-copy" class="btn-answer bg-vert" title="${chrome.i18n.getMessage("copy_the_answer")}">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M19 2h-4.18C14.4.84 13.3 0 12 0c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 18H5V4h2v3h10V4h2v16z">\n                    </path>\n                </svg>\n                ${chrome.i18n.getMessage("copy")}\n            </button>\n            <button id="qs24-answer-update" class="btn-icon-answer bg-yallow" style="display: none;">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z">\n                    </path>\n                </svg>\n            </button>\n            <button id="qs24-screen-quicksnap" class="btn-icon-answer bg-blue" title="${chrome.i18n.getMessage("quick_snap")}">\n                ${t}\n    \n            </button>\n            <button id="qs24-answer-like" class="btn-icon-answer bg-blue" title="${chrome.i18n.getMessage("good_answer")}">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z">\n                    </path>\n                </svg>\n            </button>\n            <button id="qs24-answer-dislike" class="btn-icon-answer bg-red" title="${chrome.i18n.getMessage("wrong_answer")}">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M15 3H6c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2c0 1.1.9 2 2 2h6.31l-.95 4.57-.03.32c0 .41.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5c0-1.1-.9-2-2-2zm4 0v12h4V3h-4z">\n                    </path>\n                </svg>\n            </button>\n            <span id="qs24-answer-like-span" style="display: none;">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z">\n                    </path>\n                </svg>\n                ${chrome.i18n.getMessage("like")}</span>\n            <span id="qs24-answer-dislike-span" style="display: none;">\n                <svg preserveAspectRatio="none" viewBox="0 0 24 24" class="svg-icon" xmlns="http://www.w3.org/2000/svg">\n                    <path\n                        d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z">\n                    </path>\n                </svg>\n                ${chrome.i18n.getMessage("dislike")}</span>\n            <input type="hidden" id="qs24-answer-tracking-id" value="{{trackingId}}" />\n        </footer>\n    </div>`,this.htmlContentGhost=`\n     <header>\n          <div id="qs24-hack-answer-drop" class="bg-ghost-gray">           \n         ${e}\n        </div> \n    </header>\n    <div id="sq24-loading" style="display: {{displayLoading}};">\n        <img id="sq24-box-loading" style="max-width: 100%;" src="https://quizsolverai.com/images/loading_animation.gif"\n            alt="${chrome.i18n.getMessage("loading")}" />\n    </div>\n    <div id="sq24-box-content" class="sq24-mathjax" style="display: {{displayContent}};">\n        <div id="qs24-answer-text">\n            {{answer}}\n        </div>\n        <footer>\n            <button id="qs24-answer-copy" class="btn-answer bg-vert" title="${chrome.i18n.getMessage("copy_the_answer")}">                \n                ${chrome.i18n.getMessage("copy")}\n            </button>\n            <button id="qs24-screen-quicksnap" class="btn-icon-answer bg-blue" title="${chrome.i18n.getMessage("quick_snap")}">\n                ${t}\n            </button>\n           <button id="qs24-answer-close" class="btn-answer" titre="${chrome.i18n.getMessage("close")}">\n                ${s}\n           </button>\n        </footer>\n    </div>`}imageOrQuestion(e){return e&&("ISOLVER"===e.tool||"SCREEN"===e.tool)&&e.image?`<img src="${e.image}" alt="Image" style="max-width: 100%;" />`:e&&e.prompt?this.convertNewLineToBr(e.prompt):chrome.i18n.getMessage("sorry_no_question")}displayQuestion(e){return!!e&&(!(!this.settings&&!this.settings.popup&&this.settings.popup.showQuestion&&!this.settings.popup.showCapturedImage)&&(!("ISOLVER"!==e.tool&&"SCREEN"!==e.tool||!e.image||!this.settings.popup.showCapturedImage)||!!(e&&e.prompt&&this.settings.popup.showQuestion)))}displayAnswer(e,t,s=!1){this.cleanup();const n={labelAnswer:t&&t.prompt_type?chrome.i18n.getMessage(t.prompt_type):chrome.i18n.getMessage("label_answer"),displayLoading:s?"block":"none",displayContent:s?"none":"block",displayQuestion:this.displayQuestion(t)?"block":"none",question:this.imageOrQuestion(t),answer:t&&t.answer?t.answer.replace(/\n/g,"<br>"):chrome.i18n.getMessage("sorry_no_answer"),trackingId:t&&t.tracking_id?t.tracking_id:"0"};let i="";i=this.settings&&!0===this.settings.ghostMode?this.replacePlaceholders(this.htmlContentGhost||"",n):this.replacePlaceholders(this.htmlContent||"",n),this.showPopup(i)}convertNewLineToBr(e){return e&&e.length>0?(e=e.trim()).replace(/\n/g,"<br>"):e}displayError(e){this.cleanup();const t={error:e};let s="";s=this.settings&&!0===this.settings.ghostMode?this.replacePlaceholders(this.htmlErrorGhost||"",t):this.replacePlaceholders(this.htmlError||"",t),this.showPopup(s)}replacePlaceholders(e,t){return Object.keys(t).forEach((s=>{const n=new RegExp(`{{${s}}}`,"g");e=e.replace(n,t[s])})),e}langDirection(){const e=chrome.i18n.getUILanguage();return["ar","he","fa","ur","ps","syr","dv"].some((t=>e.startsWith(t)))?"rtl":"ltr"}async showPopup(e){const t=document.createElement("div");t.id="qs24-box-answer",t.dir=this.langDirection(),t.innerHTML=e,this.settings&&!0===this.settings.ghostMode&&t.classList.add("qs25-ghost-mode"),this.settings&&this.settings.customStyle&&!0===this.settings.customStyle.enabled&&(t.style.backgroundColor=this.settings.customStyle.background,t.style.color=this.settings.customStyle.textColor,t.style.opacity=this.settings.customStyle.opacity,this.settings.customStyle.border||(t.style.border="0px solid #ccc"));const s=this.getPositionStyle(this.settings.popup.position);Object.keys(s).forEach((e=>{t.style[e]=s[e]})),document.body.appendChild(t),this.initializeDragHandle(),this.buttonEvent();const n=document.getElementById("sq24-box-content");if(n&&window.MathJax?.typesetPromise)try{await window.MathJax.typesetPromise([n])}catch(e){console.error("MathJax processing error:",e)}}cleanup(){const e=document.getElementById("qs24-box-answer");e&&e.remove()}initializeDragHandle(){const e=document.getElementById("qs24-box-answer");document.getElementById("qs24-hack-answer-drop").addEventListener("mousedown",(function(t){t.preventDefault();const s=t.clientX-e.getBoundingClientRect().left,n=t.clientY-e.getBoundingClientRect().top;function i(t){const i=t.clientX-s,o=t.clientY-n;e.style.left=i+"px",e.style.top=o+"px"}document.addEventListener("mousemove",i),document.addEventListener("mouseup",(function e(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",e)}))}))}buttonEvent(){const e="qs24-answer-copy";document.getElementById(e)&&document.getElementById(e).addEventListener("click",this.handleCopyAnswer);const t="qs24-answer-update";document.getElementById(t)&&document.getElementById(t).addEventListener("click",this.handleUpdateAnswer);const s="qs24-answer-like";document.getElementById(s)&&document.getElementById(s).addEventListener("click",this.handleLikeAnswer);const n="qs24-answer-dislike";document.getElementById(n)&&document.getElementById(n).addEventListener("click",this.handleDislikeAnswer);const i="qs24-answer-close";document.getElementById(i)&&document.getElementById(i).addEventListener("click",this.handleCloseAnswer);const o="qs24-screen-quicksnap";document.getElementById(o)&&(!this.settings||!this.settings.quickSnapMode&&!1===this.settings.quickSnapMode?document.getElementById(o).style.display="none":document.getElementById(o).addEventListener("click",this.handleQuickSnap))}handleCloseAnswer(){const e=document.getElementById("qs24-box-answer");e&&e.remove()}handleQuickSnap(){new QuizSolverSnapshot(this,this.storage)}handleUpdateAnswer(){}handleCopyAnswer(){const e=document.getElementById("qs24-answer-text");navigator.clipboard.writeText(e.innerText)}handleLikeAnswer(e){e.target.disabled=!0,this.displayResultLike("like"),chrome.runtime.sendMessage({action:"qs24_likeAnswer",tracking_id:document.getElementById("qs24-answer-tracking-id").value,like:!0},(function(t){e.target.disabled=!1,e.target.style.backgroundColor="#60a4bf"}))}handleDislikeAnswer(e){e.target.disabled=!0,this.displayResultLike("dislike"),chrome.runtime.sendMessage({action:"qs24_likeAnswer",tracking_id:document.getElementById("qs24-answer-tracking-id").value,like:!1},(function(t){e.target.disabled=!1,e.target.style.backgroundColor="#60a4bf"}))}displayResultLike(e){const t="qs24-answer-like-span",s="qs24-answer-dislike-span",n=document.getElementById("qs24-answer-like"),i=document.getElementById("qs24-answer-dislike");"like"==e?(document.getElementById(t).style.display="inline-block",document.getElementById(s).style.display="none",n.style.display="none",i.style.display="none"):"dislike"==e&&(document.getElementById(t).style.display="none",document.getElementById(s).style.display="inline-block",n.style.display="none",i.style.display="none")}}class QuizSolverSnapshot{constructor(e,t){this.cleanup(),this.settings=t&&t.settings?t.settings:null,this.popup=e||new QuizSolverPopup(t),e.cleanup(),this.overlay=this.createOverlay(),this.rect=this.createRect(),this.isDrawing=!1,this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.width=0,this.height=0,this.left=0,this.top=0,this.requestType=this.settings.defaultRequest||"SOLVE_PROBLEM",this.bindEvents()}getZoomLevel(){return window.devicePixelRatio||1}createOverlay(){const e=document.createElement("div");return e.id="qs24-hack-overlay",e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="100%",e.style.height="100%",e.style.zIndex="10000",e.style.display="block",e.style.cursor="crosshair",e}createRect(){const e=document.createElement("div");return e.id="qs24-hack-rect",e}createBtnsPanel(){if("DISABLED"===this.requestType)return"";if(!Object.values(this.settings.requestTypes).some(Boolean))return"";const e=document.createElement("div");e.id="qs24-hack-btns-panel";const t=[{type:"SOLVE_PROBLEM",requestTypeKey:"solveProblem",svg:'\n                <svg fill="#244f60" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg" stroke="#244f60">\n                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>\n                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>\n                <g id="SVGRepo_iconCarrier"> <path d="M1743.858 267.012 710.747 1300.124 176.005 765.382 0 941.387l710.747 710.871 1209.24-1209.116z" fill-rule="evenodd"></path> </g>\n                </svg>\n                '},{type:"EXPLAIN_SOLUTION",requestTypeKey:"explainSolution",svg:'<svg  viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n                        <g id="SVGRepo_iconCarrier"> <path d="M2 8C2 7.44772 2.44772 7 3 7H21C21.5523 7 22 7.44772 22 8C22 8.55228 21.5523 9 21 9H3C2.44772 9 2 8.55228 2 8Z" fill="#244f60"/> <path d="M2 12C2 11.4477 2.44772 11 3 11H21C21.5523 11 22 11.4477 22 12C22 12.5523 21.5523 13 21 13H3C2.44772 13 2 12.5523 2 12Z" fill="#244f60"/> <path d="M3 15C2.44772 15 2 15.4477 2 16C2 16.5523 2.44772 17 3 17H15C15.5523 17 16 16.5523 16 16C16 15.4477 15.5523 15 15 15H3Z" fill="#244f60"/> </g>\n                    </svg>'},{type:"MATH_OPERATIONS",requestTypeKey:"mathOperations",svg:' <svg fill="#244f60"  viewBox="0 0 256 256" id="Flat" xmlns="http://www.w3.org/2000/svg">\n                <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n                <g id="SVGRepo_iconCarrier"> <path d="M116,184a12,12,0,0,1-12,12H84v20a12,12,0,0,1-24,0V196H40a12,12,0,0,1,0-24H60V152a12,12,0,0,1,24,0v20h20A12,12,0,0,1,116,184ZM104,60H40a12,12,0,0,0,0,24h64a12,12,0,0,0,0-24Zm48,116.06641h64a12,12,0,0,0,0-24H152a12,12,0,0,0,0,24Zm64,15.86718H152a12,12,0,0,0,0,24h64a12,12,0,0,0,0-24Zm-64.48535-87.44824a12.00033,12.00033,0,0,0,16.9707,0L184,88.9707l15.51465,15.51465a12.0001,12.0001,0,0,0,16.9707-16.9707L200.9707,72l15.51465-15.51465a12.0001,12.0001,0,0,0-16.9707-16.9707L184,55.0293,168.48535,39.51465a12.0001,12.0001,0,0,0-16.9707,16.9707L167.0293,72,151.51465,87.51465A12.00062,12.00062,0,0,0,151.51465,104.48535Z"/> </g>\n            </svg>'},{type:"GEOMETRIC_CALCULATIONS",requestTypeKey:"geometryCalculations",svg:'<svg fill="#244f60" version="1.1"  viewBox="0 0 270.06 270.06" xml:space="preserve" stroke="#244f60" stroke-width="8.1018">\n                <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n                <g id="SVGRepo_iconCarrier"> <path color-rendering="auto" image-rendering="auto" shape-rendering="auto" color-interpolation="sRGB" d="M264.898,0.007 c-0.181,0.006-0.362,0.023-0.541,0.049H84.996c-1.326,0-2.598,0.527-3.535,1.465l-80,80C0.525,82.459-0.001,83.73,0,85.056v180 c0,2.761,2.239,5,5,5h180c1.326,0,2.598-0.527,3.535-1.465l80-80c0.938-0.938,1.465-2.209,1.465-3.535V5.819 c0.14-0.893,0.035-1.807-0.303-2.645c-0.016-0.045-0.033-0.09-0.051-0.135c-0.808-1.89-2.69-3.093-4.744-3.033L264.898,0.007z M87.066,10.056h165.859l-70,70H17.066L87.066,10.056z M259.996,17.126v165.859l-70,70V87.126L259.996,17.126L259.996,17.126z M84.92,19.985c-2.759,0.042-4.963,2.311-4.924,5.07v40c-0.039,2.761,2.168,5.032,4.929,5.071s5.032-2.168,5.071-4.929 c0.001-0.047,0.001-0.094,0-0.141v-40c0.039-2.761-2.168-5.031-4.93-5.07C85.018,19.984,84.969,19.984,84.92,19.985z M9.996,90.056 h170v170h-170V90.056L9.996,90.056z M84.92,99.985c-2.759,0.042-4.963,2.311-4.924,5.07v30c-0.039,2.761,2.168,5.032,4.929,5.071 s5.032-2.168,5.071-4.929c0.001-0.047,0.001-0.094,0-0.141v-30c0.039-2.761-2.168-5.031-4.93-5.07 C85.018,99.984,84.969,99.984,84.92,99.985z M84.92,159.985c-2.759,0.042-4.963,2.311-4.924,5.07v17.93L61.461,201.52 c-1.992,1.913-2.057,5.078-0.144,7.07c1.913,1.992,5.078,2.057,7.07,0.144c0.049-0.047,0.097-0.095,0.144-0.144l18.535-18.535h17.93 c2.761,0.039,5.032-2.168,5.071-4.929s-2.168-5.032-4.929-5.071c-0.047-0.001-0.094-0.001-0.141,0h-15v-15 c0.039-2.761-2.168-5.031-4.93-5.07C85.018,159.984,84.969,159.984,84.92,159.985z M134.996,180.055 c-2.761-0.039-5.032,2.168-5.071,4.929c-0.039,2.761,2.168,5.032,4.929,5.071c0.047,0.001,0.094,0.001,0.141,0h30 c2.761,0.039,5.032-2.168,5.071-4.929c0.039-2.761-2.168-5.032-4.929-5.071c-0.047-0.001-0.094-0.001-0.141,0H134.996z M204.996,180.055c-2.761-0.039-5.032,2.168-5.071,4.929c-0.039,2.761,2.168,5.032,4.929,5.071c0.047,0.001,0.094,0.001,0.141,0h40 c2.761,0.039,5.032-2.168,5.071-4.929s-2.168-5.032-4.929-5.071c-0.047-0.001-0.094-0.001-0.141,0H204.996z M44.898,220.007 c-1.299,0.039-2.532,0.582-3.438,1.514l-20,20c-1.992,1.913-2.057,5.078-0.144,7.07c1.913,1.992,5.078,2.057,7.07,0.144 c0.049-0.047,0.097-0.095,0.144-0.144l20-20c1.98-1.925,2.025-5.091,0.1-7.071C47.654,220.514,46.3,219.965,44.898,220.007z"/> </g>\n            </svg>'},{type:"TRANSLATE_TEXT",requestTypeKey:"translateText",svg:' <svg viewBox="0 0 48 48" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" fill="#244f60" stroke="#244f60" stroke-width="2.544">\n            <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n            <g id="SVGRepo_iconCarrier"> <defs> <style> .cls-1 { fill: none; stroke:#244f60; stroke-linecap: round; stroke-linejoin: round; } </style> </defs> <line class="cls-1" x1="12.62" y1="24.31" x2="17.94" y2="11.42"/> <line class="cls-1" x1="23.04" y1="24.35" x2="17.94" y2="11.42"/> <line class="cls-1" x1="21.34" y1="20.02" x2="14.39" y2="20.02"/> <g> <line class="cls-1" x1="32.63" y1="25.38" x2="39.35" y2="25.38"/> <path class="cls-1" d="M35.68,25.38c0,4.34-5.29,11.51-10.59,12.61"/> <path class="cls-1" d="M27.93,32.79c2.13,2.4,5.61,4.74,8.82,5.2"/> </g> <rect class="cls-1" x="5.5" y="5.5" width="24.67" height="24.67" rx="3.64" ry="3.64"/> <path class="cls-1" d="M17.83,30.17v8.69c0,2,1.64,3.64,3.64,3.64h17.38c2,0,3.64-1.64,3.64-3.64V21.47c0-2-1.64-3.64-3.64-3.64h-8.69"/> </g>\n            </svg>'},{type:"EXTRACT_TEXT_FROM_IMAGE",requestTypeKey:"extractTextFromImage",svg:' <svg   viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n                <g id="SVGRepo_iconCarrier"> \n                <path fill-rule="evenodd" clip-rule="evenodd"\n                 d="M15 1.25C15.4142 1.25 15.75 1.58579 15.75 2V3.2555C16.9594 3.26793 17.9701 3.30925 18.8089 3.45158C19.8369 3.626 20.6807 3.96316 21.3588 4.64124C22.1071 5.38961 22.4392 6.33856 22.5969 7.51098C22.75 8.65018 22.75 10.1058 22.75 11.9435V12.0564C22.75 13.8942 22.75 15.3498 22.5969 16.489C22.4392 17.6614 22.1071 18.6104 21.3588 19.3588C20.6807 20.0368 19.8369 20.374 18.8089 20.5484C17.9701 20.6908 16.9594 20.7321 15.75 20.7445V22C15.75 22.4142 15.4142 22.75 15 22.75C14.5858 22.75 14.25 22.4142 14.25 22V2C14.25 1.58579 14.5858 1.25 15 1.25ZM15.75 19.2443V4.75569C16.9362 4.76835 17.8391 4.80847 18.558 4.93044C19.3998 5.07329 19.9131 5.31689 20.2981 5.7019C20.7213 6.12511 20.975 6.70476 21.1102 7.71085C21.2484 8.73851 21.25 10.0932 21.25 12C21.25 13.9068 21.2484 15.2615 21.1102 16.2892C20.975 17.2952 20.7213 17.8749 20.2981 18.2981C19.9131 18.6831 19.3998 18.9267 18.558 19.0696C17.8391 19.1915 16.9362 19.2316 15.75 19.2443Z" fill="#244f60"/> <path d="M9.94358 3.25L12 3.25C12.4142 3.25 12.75 3.58579 12.75 4C12.75 4.41421 12.4142 4.75 12 4.75H10C8.09318 4.75 6.73851 4.75159 5.71085 4.88976C4.70476 5.02502 4.12511 5.27869 3.7019 5.7019C3.27869 6.12511 3.02503 6.70476 2.88976 7.71085C2.75159 8.73851 2.75 10.0932 2.75 12C2.75 13.9068 2.75159 15.2615 2.88976 16.2892C3.02503 17.2952 3.27869 17.8749 3.7019 18.2981C4.12511 18.7213 4.70476 18.975 5.71085 19.1102C6.73851 19.2484 8.09318 19.25 10 19.25H12C12.4142 19.25 12.75 19.5858 12.75 20C12.75 20.4142 12.4142 20.75 12 20.75H9.94359C8.10585 20.75 6.65018 20.75 5.51098 20.5969C4.33856 20.4392 3.38961 20.1071 2.64124 19.3588C1.89288 18.6104 1.56076 17.6614 1.40314 16.489C1.24997 15.3498 1.24998 13.8942 1.25 12.0564V11.9436C1.24998 10.1058 1.24997 8.65019 1.40314 7.51098C1.56076 6.33856 1.89288 5.38961 2.64124 4.64124C3.38961 3.89288 4.33856 3.56076 5.51098 3.40314C6.65019 3.24997 8.10582 3.24998 9.94358 3.25Z" fill="#244f60"/> <path d="M6.81782 7.78733C7.11779 7.74992 7.48429 7.74996 7.88383 7.75H10.1162C10.5157 7.74996 10.8822 7.74992 11.1822 7.78733C11.5109 7.82833 11.8612 7.9242 12.1624 8.19187C12.2138 8.23753 12.2625 8.28618 12.3081 8.33756C12.5758 8.63878 12.6717 8.98915 12.7127 9.31782C12.7501 9.61779 12.7501 9.98428 12.75 10.3838L12.75 10.425C12.75 10.8392 12.4142 11.175 12 11.175C11.5858 11.175 11.25 10.8392 11.25 10.425C11.25 9.97047 11.2486 9.69931 11.2242 9.50348C11.1998 9.30765 10.9965 9.2758 10.9965 9.2758C10.8007 9.25137 10.5295 9.25001 10.075 9.25001H9.75001V14.75H11C11.4142 14.75 11.75 15.0858 11.75 15.5C11.75 15.9142 11.4142 16.25 11 16.25H7.00001C6.58579 16.25 6.25001 15.9142 6.25001 15.5C6.25001 15.0858 6.58579 14.75 7.00001 14.75H8.25001V9.25001H7.92501C7.47047 9.25001 7.19931 9.25137 7.00348 9.2758C7.00348 9.2758 6.80023 9.30765 6.7758 9.50348C6.75138 9.69931 6.75001 9.97047 6.75001 10.425C6.75001 10.8392 6.41422 11.175 6.00001 11.175C5.58579 11.175 5.25001 10.8392 5.25001 10.425L5.25 10.3838C5.24996 9.98428 5.24992 9.61779 5.28733 9.31782C5.32833 8.98915 5.4242 8.63878 5.69187 8.33756C5.73753 8.28618 5.78618 8.23753 5.83757 8.19187C6.13878 7.9242 6.48915 7.82833 6.81782 7.78733Z" \n                fill="#244f60"/> \n                </g>\n            </svg>'},{type:"REWRITE_TEXT",requestTypeKey:"rewriteText",svg:'<svg width="800px" height="800px" viewBox="0 0 24 24" version="1.1" xml:space="preserve"\n                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#244f60">\n                <g id="SVGRepo_bgCarrier" stroke-width="0"/>\n                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"/>\n                <g id="SVGRepo_iconCarrier"> <style type="text/css"> .st0{opacity:0.2;fill:none;stroke:#244f60;stroke-width:5.000000e-02;stroke-miterlimit:10;} </style> <g id="grid_system"/> <g id="_icons"> <g> <path d="M21.8,4.5c-0.3-0.7-0.9-1.3-1.6-1.6c-1.5-0.6-3.2,0.1-3.9,1.5l-4.6,10.3c-0.4,0.9-0.5,2-0.4,2.9l0.4,2.2 c0.1,0.3,0.3,0.6,0.6,0.7c0.1,0.1,0.3,0.1,0.4,0.1c0.2,0,0.4-0.1,0.5-0.2l1.9-1.2c0.9-0.6,1.5-1.3,1.9-2.3l4.6-10.3 C22.1,6,22.1,5.2,21.8,4.5z M15.4,16.3c-0.3,0.6-0.7,1-1.2,1.4l-0.7,0.4l-0.1-0.7c-0.1-0.6,0-1.2,0.2-1.8l3.5-8l1.8,0.7L15.4,16.3 z M20,5.9l-0.2,0.5L18,5.7l0.2-0.5c0.2-0.4,0.5-0.6,0.9-0.6c0.1,0,0.3,0,0.4,0.1C19.7,4.8,19.9,5,20,5.2c0,0,0,0,0,0 C20.1,5.5,20.1,5.7,20,5.9z"/> <path d="M3,17h4c0.6,0,1-0.4,1-1s-0.4-1-1-1H3c-0.6,0-1,0.4-1,1S2.4,17,3,17z"/> <path d="M9,19H3c-0.6,0-1,0.4-1,1s0.4,1,1,1h6c0.6,0,1-0.4,1-1S9.6,19,9,19z"/> </g> </g> </g>\n                </svg>'}].map((e=>this.settings.requestTypes[e.requestTypeKey]?`\n                    <button class="qs24-icon-btn ${this.requestType===e.requestTypeKey?"active":""}" \n                            data-tooltip="${chrome.i18n.getMessage(e.type)}" \n                            data-type="${e.type}">\n                        ${e.svg}\n                    </button>\n                `:"")).join("");return e.innerHTML=`\n            ${t}\n            <button class="qs24-close-btn" data-tooltip="Hide panel">\n                <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>\n            </button>\n        `,e}bindEvents(){document.body.appendChild(this.overlay),this.overlay.appendChild(this.rect);let e=this.createBtnsPanel();e.querySelector(".qs24-close-btn").addEventListener("click",(()=>{this.cleanup()})),e.querySelectorAll(".qs24-icon-btn").forEach((t=>{t.addEventListener("click",(t=>{e.querySelectorAll(".qs24-icon-btn").forEach((e=>e.classList.remove("active")));const s=t.currentTarget,n=s.getAttribute("data-type");this.requestType=n,this.settings.defaultRequest=n,s.classList.add("active")}))})),this.overlay.appendChild(e),this.overlay.addEventListener("mousedown",(e=>this.startDrawing(e))),this.overlay.addEventListener("mousemove",(e=>this.draw(e))),this.overlay.addEventListener("mouseup",(e=>this.finishDrawing(e)))}startDrawing(e){e.target.closest("#qs24-hack-btns-panel")||(this.isDrawing=!0,this.startX=e.clientX,this.startY=e.clientY)}draw(e){e.target.closest("#qs24-hack-btns-panel")||this.isDrawing&&(this.endX=e.clientX,this.endY=e.clientY,this.width=Math.abs(this.endX-this.startX),this.height=Math.abs(this.endY-this.startY),this.left=Math.min(this.startX,this.endX),this.top=Math.min(this.startY,this.endY),this.rect.style.left=`${this.left}px`,this.rect.style.top=`${this.top}px`,this.rect.style.width=`${this.width}px`,this.rect.style.height=`${this.height}px`)}async finishDrawing(e){if(e.target.closest("#qs24-hack-btns-panel"))return;this.isDrawing=!1;await this.cleanup()?this.getAnswerV2():console.log(chrome.i18n.getMessage("overlay_already_removed"))}getAnswerV2(){let e={width:this.width,height:this.height,left:this.left,top:this.top,devicePixelRatio:this.getZoomLevel()},t={user_lang:this.settings.language,prompt_type:this.requestType,image:e,source:window.location.href,tool:"SCREEN",type:"IMAGE"},s=this;chrome.runtime.sendMessage({action:"qs24_getAnswerV2",request:t},(function(e){if(e)if(e.errorMsg||e.error)s.popup.displayError(e.errorMsg||e.error);else{let t=(e.image?"<img src='"+e.image+"' >":null)||e.prompt;s.popup.displayAnswer(t,e)}else s.popup.displayError(ALERT_SOMETHING_WORNG)}))}popupImage(e){this.overlay=this.createOverlay();const t=document.createElement("img");t.src=e,t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.maxWidth="90%",t.style.maxHeight="90%",t.style.zIndex="10000",t.style.cursor="pointer",this.overlay.appendChild(t),document.body.appendChild(this.overlay)}cleanup(){return new Promise(((e,t)=>{const s=document.getElementById("qs24-hack-overlay");s&&s.parentNode?(s.parentNode.removeChild(s),requestAnimationFrame((()=>e(!0)))):e(!1),this.rect&&(this.rect.style.width="0px",this.rect.style.height="0px")}))}}class QuizSolverStorageSync{constructor(){this.user=null,this.settings=null,this.loadInitialData(),this.listenForStorageChanges()}loadInitialData(){chrome.storage.sync.get(["user","settings"],(e=>{e.user&&(this.user=e.user),e.settings&&(this.settings=e.settings)}))}listenForStorageChanges(){chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&(e.user&&(this.user=e.user.newValue),e.settings&&(this.settings=e.settings.newValue))}))}async isLoggedIn(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({action:"qs24_verifySession"},(s=>{chrome.runtime.lastError?(console.error("Error verifying session:",chrome.runtime.lastError.message),t(!1)):e(s.isLoggedIn)}))}))}}class QuizSolverAutoDetect{constructor(e,t){this.settings=t&&t.settings?t.settings:null,this.popup=e||new QuizSolverPopup(t),this.bntClassName="QS24-btn-inject-question",this.supportedSites=[{baseUrl:"coursera.org",element:".rc-FormPartsQuestion",subElementFormBtn:".rc-FormPartsQuestion__numberCell",avoid:[".rc-FormPartsQuestion__numberCell",".rc-FormPartsQuestion__pointsCell"],deleteText:[""],css:"font-size: 12px;margin-left: -5px;",type:"MCQ"},{baseUrl:"openclassrooms.com",element:".mcqView__question",subElementFormBtn:".mcqQuestion__content.userContent",avoid:["h3.secondTitle.mcqQuestion__title"],deleteText:[""],css:"font-size: 12px;",type:"MCQ"},{baseUrl:"khanacademy.org",element:'form[name="answerform"]',subElementFormBtn:".paragraph",avoid:[],deleteText:[""],css:"",type:"QUESTION"},{baseUrl:"kidsquizdaily.co.uk",element:"#fca_qc_answer_container",subElementFormBtn:"#fca_qc_question",avoid:[],deleteText:[""],css:"",type:"MCQ"},{baseUrl:"act.org",element:".individualQuestion",subElementFormBtn:".order-list-no",avoid:[".order-list-no",'button[name="submit"]'],deleteText:[""],css:"margin: 0 0 0 -7px;",type:"MCQ"},{baseUrl:"proprofs.com",element:".m_questionbigbox",subElementFormBtn:".quiz_tablediv",avoid:["style","script",".mobile_next_btn_holder",".m_nqbuttton"],deleteText:[""],css:"",type:"MCQ"},{baseUrl:"proprofs.com",element:".questionexcert.topic-story",subElementFormBtn:".ques_hover_span",avoid:["style","script",".sam_ques"],deleteText:[""],css:"",type:"MCQ"},{baseUrl:"app.codility.com",element:"#task_description",subElementFormBtn:'div[data-test-id="tab"]',avoid:["style","script",'div[aria-labelledby="select-variant-prg_lang-label"]','ul[data-test-options-for="select-variant-prg_lang"]'],deleteText:[],css:"",type:"CODE"},{baseUrl:"proprofs.com",element:".quiz-page-content",subElementFormBtn:".ques_hover_span",avoid:["style","script",".sam_ques"],deleteText:[""],css:"",type:"MCQ"},{baseUrl:"quora.com",element:'#mainContent [class*="dom_annotate_multifeed_bundle_"]',subElementFormBtn:".q-box.qu-mb--tiny > .q-text",avoid:[],deleteText:[],css:"",type:"QUESTION"},{baseUrl:"udemy.com",element:'[class^="mc-quiz-question--container--"]',subElementFormBtn:":scope > span",avoid:['[class^="popper-module--popper-content--"]',":scope > span"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"quiz-maker.com",element:"#quiz-tabs .sel",subElementFormBtn:".qp_qi",avoid:["style","script"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"indiabix.com",element:".test-content .bix-div-container",subElementFormBtn:".bix-td-qtxt",avoid:["style","script",".bix-td-qno",".bix-td-miscell"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"quizlet.com",element:'[aria-label="question"]',subElementFormBtn:'[data-testid="Question Text"]',avoid:["style","script",".wlbcmo",".t1b9wj7u"],deleteText:[],css:"flex: 0 0 35px;margin-left: 0;",type:"MCQ"},{baseUrl:"byjus.com",element:"#interactive-quiz-ias .interactive-quiz-item-content-ias",subElementFormBtn:"p.ias-question-font",avoid:[".badge.radio-badge"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"quizforfriend.com",element:".questionBox",subElementFormBtn:"#question-text",avoid:["h6"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"quipoquiz.com",element:".container_question",subElementFormBtn:".tf_question",avoid:[".tf_answer",".col_quiz_image"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"aacc.instructure.com",element:'[aria-label="Question"]',subElementFormBtn:".text .question_text",avoid:[".move",".flag_question",".header",".links",".original_question_text",".question_type",".regrade_disabled"],deleteText:["multiple_choice_question"],css:"",type:"MCQ"},{baseUrl:"learn.luiss.it",element:".formulation.clearfix",subElementFormBtn:".qtext",avoid:["legend",".accesshide"],deleteText:[],css:"",type:"MCQ"},{baseUrl:"stackoverflow.com",element:"#question-header",subElementFormBtn:"h1",avoid:[],deleteText:[],css:"",type:"QUESTION"},{baseUrl:"leetcode.com",element:"#qd-content",subElementFormBtn:"#description_tab",avoid:["#description_tabbar_outer","#code_tabbar_outer","#testcase_tabbar_outer",".flex.gap-1 > .relative.inline-flex"],deleteText:[],css:"",type:"QUESTION"},{baseUrl:"classmarker.com",element:"ion-list.question-content-area",subElementFormBtn:".bbcode",avoid:[],deleteText:[],css:"",type:"MCQ"},{baseUrl:"skillvalue.com",element:"app-quiz-question",subElementFormBtn:".header-container",avoid:[],deleteText:[],css:"",type:"MCQ"},{baseUrl:"laniertech.blackboard.com",element:"fieldset",subElementFormBtn:".legend-visible",avoid:["script","style"],deleteText:[],css:"",type:"MCQ"}],this.setupObserver()}setupObserver(){if(this.settings&&!0===this.settings.isActive&&!0===this.settings.autoDetection){this.launchAutoDetection();new MutationObserver(this.handleMutations.bind(this)).observe(document.body,{childList:!0,subtree:!0})}}handleMutations(e){for(const t of e)"childList"!==t.type&&"subtree"!==t.type||this.launchAutoDetection()}launchAutoDetection(){const e=window.location.href;this.supportedSites.forEach((t=>{t.baseUrl&&e.includes(t.baseUrl)&&this.detectAndInjectButton(t)}))}detectAndInjectButton(e){document.querySelectorAll(e.element).forEach((t=>{t&&!t.querySelector("."+this.bntClassName)&&this.createButton(t,e)}))}createButton(e,t){const s=document.createElement("a");s.className="QS24-btn-inject-question",s.style.cssText=`\n            background: url('${chrome.runtime.getURL("assets/logo.png")}') no-repeat;\n            border: none;\n            padding: 0;\n            cursor: pointer;\n            background-size: contain;\n            font-size: 0;\n            width: 26px;\n            height: 26px;\n            margin: 2px 8px;\n            display: inline-block;\n            vertical-align: middle;\n            z-index: 10000;\n            ${t.css||""}\n        `,s.addEventListener("click",(()=>this.handleButtonClick(e,t)));const n=e.querySelector(t.subElementFormBtn);n&&n.appendChild(s)}handleButtonClick(e,t){try{this.popup.displayAnswer(null,null,!0);const s=e.cloneNode(!0);t.avoid&&t.avoid.length>0&&t.avoid.forEach((e=>{s.querySelectorAll(e).forEach((e=>e.remove()))}));const n=this.getTextFromNode(s).trim();chrome.runtime.sendMessage({action:"qs24_getAnswer",prompt:n,source:window.location.href,tool:t.type},(e=>{e.errorMsg||e.error?this.popup.displayError(e.errorMsg?e.errorMsg:e.error):this.popup.displayAnswer(n,{text:e.answer,tracking_id:e.tracking})}))}catch(e){console.log("Error:",e)}}getTextFromNode(e){let t="";for(const s of e.childNodes)s.nodeType===Node.TEXT_NODE?t+=s.textContent:s.nodeType===Node.ELEMENT_NODE&&(t+=this.getTextFromNode(s),["BLOCKQUOTE","DIV","P","BR","HR","LI"].includes(s.tagName)&&(t+="\n"));return t.split("\n").filter((e=>""!==e.trim())).join("\n")}}class QuizSolverImageSolver{constructor(e,t){this.popup=e,e.cleanup(),this.settings=t&&t.settings?t.settings:null,this.user=t&&t.user?t.user:null,this.requestType=null,this.boundMouseOverHandler=null,this.svgIcon='\n            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <circle cx="12" cy="12" r="10"/>\n                <path d="M12 16v-4"/>\n                <path d="M12 8h.01"/>\n            </svg>\n        ',this.settings&&!0===this.settings.isActive&&!0===this.settings.imageSolver?this.init():this.cleanup()}init(){this.setupImageHoverListeners()}setupImageHoverListeners(){this.boundMouseOverHandler=this.handleMouseOver.bind(this),document.addEventListener("mouseover",this.boundMouseOverHandler,!0)}handleMouseOver(e){const t=e.target.closest("img");t&&(t.src.includes(".jpg")||t.src.includes(".png"))&&!t.parentElement.classList.contains("QS24-img-wrapper")&&this.wrapImage(t)}cleanup(){this.boundMouseOverHandler&&(document.removeEventListener("mouseover",this.boundMouseOverHandler,!0),this.boundMouseOverHandler=null),this.unwrapAllImages()}unwrapAllImages(){try{const e=Array.from(document.querySelectorAll(".QS24-img-wrapper"));if(0===e.length)return;e.forEach((e=>{try{const t=e.querySelector("img"),s=e.parentNode;if(t&&s){const n=e.querySelector(".QS24-img-overlay-btn"),i=e.querySelector(".QS24-img-dropdown-menu");n&&n.remove(),i&&i.remove();const o=t.cloneNode(!0);s.insertBefore(o,e),e.remove()}}catch(e){console.error("Error unwrapping individual image:",e)}}))}catch(e){console.error("Error in unwrapAllImages:",e)}}createButton(){const e=document.createElement("button");return e.className="QS24-img-overlay-btn",e.innerHTML=this.svgIcon,e}createDropdownMenu(){const e=document.createElement("div");e.className="QS24-img-dropdown-menu";return[{key:"SOLVE_PROBLEM",value:"Solve"},{key:"EXPLAIN_SOLUTION",value:"Explain"},{key:"EXTRACT_TEXT_FROM_IMAGE",value:"Extract Text"}].forEach((t=>{const s=document.createElement("button");s.className="QS24-img-dropdown-item",s.textContent=t.value,s.addEventListener("click",(e=>{e.stopPropagation(),this.handleOptionClick(t,e.target.closest(".QS24-img-wrapper").querySelector("img"))})),e.appendChild(s)})),e}async getAnswerISV2(e,t,s){this.requestType=s;const n={user_lang:this.settings.language,prompt_type:this.requestType,image:t,dataUrlImg:e,source:window.location.href,tool:"ISOLVER",type:"IMAGE",user_id:this.user?this.user.id:null};try{let e=this;chrome.runtime.sendMessage({action:"qs24_getImageSolver",request:n},(function(t){t?t.errorMsg||t.error?e.popup.displayError(t.errorMsg||t.error):e.popup.displayAnswer("",t):e.popup.displayError(ALERT_SOMETHING_WORNG)}))}catch(e){throw console.error("Error getting answer:",e),e}}async handleOptionClick(e,t){try{let s=document.createElement("canvas"),n=s.getContext("2d");s.width=t.width,s.height=t.height,n.drawImage(t,0,0,t.width,t.height);const i=s.toDataURL("image/jpeg"),o=await this.getAnswerISV2(i,t.src,e.key);this.showResult(o,e.key)}catch(t){console.error(`Error handling ${e} option:`,t)}}showResult(e,t){e?e.errorMsg||e.error?this.popup.displayError(e.errorMsg||e.error):this.popup.displayAnswer(null,{text:e.answer,tracking_id:e.tracking}):this.popup.displayError(chrome.i18n.getMessage("alert_something_wrong"))}wrapImage(e){if(e.parentElement.classList.contains("QS24-img-wrapper"))return;const t=document.createElement("div");t.className="QS24-img-wrapper",e.parentNode.insertBefore(t,e),t.appendChild(e);const s=this.createButton(),n=this.createDropdownMenu();t.appendChild(s),t.appendChild(n),s.addEventListener("mouseenter",(()=>{n.classList.add("QS24-img-show")})),t.addEventListener("mouseleave",(()=>{n.classList.remove("QS24-img-show")}))}}class QuizSolverTools{static cleanHTML(e){try{const t=(new DOMParser).parseFromString(e,"text/html");["script","style","head","meta","link","noscript","iframe"].forEach((e=>{const s=t.getElementsByTagName(e);for(;s.length>0;)s[0].parentNode.removeChild(s[0])}));(e=>{const t=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT,null,!1),s=[];let n;for(;n=t.nextNode();)s.push(n);s.forEach((e=>{e.parentNode.removeChild(e)}))})(t.documentElement);return(e=>{const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,null,!1),s=[];let n;for(;n=t.nextNode();)n.textContent.trim()||n.querySelector("img")||n.querySelector("video")||n.querySelector("audio")||n.querySelector("canvas")||n.querySelector("svg")||s.push(n);s.forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))})(t.body),t.body.innerHTML}catch(t){return console.error("Error cleaning HTML:",t),e}}}var quizSolverPopup,quizSolverAutoDetect,imageSolver,loggedIn,quizSolverStorageSync=new QuizSolverStorageSync;function createToastContainer(){const e=document.createElement("div");e.id="qs24-toast-container",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      z-index: 99999;\n    ",document.body.appendChild(e)}function showToast(e,t="error"){const s=document.getElementById("qs24-toast-container")||(createToastContainer(),document.getElementById("qs24-toast-container")),n=document.createElement("div");n.className=`qs24-toast qs24-toast-${t}`,n.style.cssText=`\n      background-color: ${"error"===t?"#ff4444":"#333"};\n      color: white;\n      padding: 12px 24px;\n      border-radius: 4px;\n      margin-bottom: 10px;\n      box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n      opacity: 0;\n      transition: opacity 0.3s ease-in;\n      font-family: Arial, sans-serif;\n      font-size: 14px;\n      max-width: 300px;\n      word-wrap: break-word;\n    `;const i=document.createElement("div");i.textContent=e,n.appendChild(i),s.appendChild(n),setTimeout((()=>{n.style.opacity="1"}),10),setTimeout((()=>{n.style.opacity="0",setTimeout((()=>{s.removeChild(n),0===s.children.length&&s.remove()}),300)}),3e3)}(async()=>{loggedIn=await quizSolverStorageSync.isLoggedIn(),quizSolverPopup=await new QuizSolverPopup(quizSolverStorageSync),quizSolverAutoDetect=await new QuizSolverAutoDetect(quizSolverPopup,quizSolverStorageSync),imageSolver=await new QuizSolverImageSolver(quizSolverPopup,quizSolverStorageSync)})(),chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&(e.settings||e.user)&&(async()=>{quizSolverPopup=await new QuizSolverPopup(quizSolverStorageSync),quizSolverAutoDetect=await new QuizSolverAutoDetect(quizSolverPopup,quizSolverStorageSync),imageSolver=await new QuizSolverImageSolver(quizSolverPopup,quizSolverStorageSync)})()})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("qs24_capture_action"===e.action){new QuizSolverSnapshot(quizSolverPopup,quizSolverStorageSync);return!0}if("qs24_getSelectedText"===e.action){s({selectedText:window.getSelection().toString()})}if("qs24_selectionText_prompt"===e.action){if(e&&e.errorMsg)return quizSolverPopup.displayError(e.errorMsg),!0;const t=e.selectedText;return quizSolverPopup.displayAnswer(t,e.answer),s({response:"Message displayAnswer"}),!0}if("qs24_spinner_selectionText_prompt"===e.action)return quizSolverPopup.displayAnswer(null,null,!0),s({response:"Message display loading ..."}),!0;if("qs24_spinner_captureVisibleTab"===e.action)return quizSolverPopup.displayAnswer(null,null,!0),s({response:"Message display loading ..."}),!0;if("qs24_show_toast"===e.action&&(showToast(e.message,e.type),s({success:!0})),"qs24_findSelectedElement"===e.action){try{const e=window.getSelection();if(e.rangeCount>0){const t=e.getRangeAt(0),n=3===t.commonAncestorContainer.nodeType?t.commonAncestorContainer.parentNode:t.commonAncestorContainer;s(n?{selectedElement:n.outerHTML}:{selectedElement:null})}}catch(e){s({selectedElement:null})}return!0}}));